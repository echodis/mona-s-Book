## 第五章：引用类型

1. 使用对象
2. 创建并操作数组
3. 理解基本的JavaScript类型
4. 使用基本类型和基本包装类型

对象是某个特定引用类型的**实例**。新对象是使用new操作符后跟一个构造函数来创建的。构造函数本身就是一个函数，只不过该函数只是处于创建新对象的目的而定义的。

### 5.1 Object类型

Object类型是ECMAScript中使用最多的一个类型。

有两种创建Object实例的方式：

* 使用new操作符后跟Object构造函数。
* 使用对象字面量表示法。

````js
// 第一种
var person = new Object();
person.name = "Nicholas";
// 第二种
var person = {
	name = "Nicholas",
	age = 20
};
````

访问对象属性时有两种方法：

* 点表示法：person.name
* 方括号表示法：person["name"]。可以通过**变量**访问属性。

### 5.2 Array类型

ECMAScript数组与其他数组有以下不同：

* 数组的每一项可以保存任何类型的数据；
* 数组的大小可以动态调整（随着数据的添加自动添加）；

创建数组的基本方式有两种：

1. 使用Array构造函数。
2. 使用数组字面量表示法。

````js
// 第一种方法, 也可以省略`new`操作符。
var colors1 = new Array();
var colors2 = new Array(3);
var colors3 =  new Array("red");
var colors4 = new Array("red", "blue", "yellow");
// 第二种方法
var colors = ["red", "blue", "green"];
````

数组有一个`length`属性——它不只是只读的。（通过设置length可以从数组末尾移除项或向数组添加新项。如：`arr.length = new_item`

#### 检测数组

`Array.isArray(value)`：最终确定某个值是否是数组。

所有的函数参数都是**按值传递**的。即把值赋值给命名参数`arguments`的一个元素。

当参数为对象类型时，对象的引用通过按值传递后也能被处理函数引用到。

#### 转换方法

* toString()：返回数组元素以逗号分隔的字符串。
* valueOf()：返回结果与toString()相同。
* toLocaleString()：数组元素以逗号分隔的字符串，调用toLocaleString方法。
* join(separator)方法：自定义分隔符

若数组中某一项是undefined，则返回结果以空字符串表示。






### 4.2 执行环境和作用域

#### 执行环境

执行环境（execution context）简称为环境。它定义了变量或函数有权访问的范围。

每个环境都有一个与之关联的**变量对象（variable object）**，环境中定义的所有变量和函数都保存在这个对象中。

全局环境是最外围的执行环境。根据ECMAScript实现宿主环境的不同，执行环境的对象也不一样（web浏览器中是window对象）。

当某个环境中所有代码执行完毕，该环境随之销毁。全局环境直到程序退出或关闭网页时——才会被销毁。

**每个函数都有一个执行环境**。当执行流进入一个函数时，该函数对应的执行环境就会被推入一个环境栈中，在函数执行完后，栈将其环境推出，把控制权返回给其之前的执行环境。

#### 作用域

一段代码在执行环境中执行时，会创建变量对象的一个作用域（scope chain），以保证对**执行环境有权访问的所有变量和函数的有序访问**。

作用域链的最前端始终是当前执行的代码所在环境的变量对象（这个对象包含作用于内的变量），下一个变量来自外部环境，再下一个则来自再下一个外部环境，一直延续到全局执行环境。全局执行环境的变量对象始终都是作用域链中的最后一个对象。

作用域的图表表示如下：

![保留字和关键字列表](./images/xx.jpg)


矩形表示特定执行环境。其中内部环境可以通过作用域访问所有外部环境，但外部环境不能访问内部环境中的任何变量和函数。任何环境都可以向上走索作用域链，但都不能向下搜索从而进入另一个执行环境。

#### 延长作用域链

思路是在作用域链的前端临时增加一个变量对象，该变量对象会在代码执行后被移除。当执行流得以进入下列任何一个语句时，作用域链就会被加长：

- [x] try-catch 语句的catch块；
- [x] with语句

这两个语句都会在作用域链前端增加一个变量对象，with将指定对象添加到作用域中（？？）；catch会创建一个新的变量对象，其包含的是被抛出的错误对象的声明。

#### 没有块级作用域

由花括号封闭的代码块如if语句、for语句**没有**单独作用域。

* 声明变量时：

	* 使用`var`声明的变量会自动添加到最接近的环境中（函数内部就是函数的局部环境，**with语句中最接近的就是函数环境**）。
	* 省略`var`关键字时，变量就会自动被添加到全局环境中。

* 查询标识符：

在某个环境中必须通过搜索来确定该标识符时，搜索过程从**作用域链最前端**开始，向上逐级查询与给定名字匹配的标识符。如果在局部环境中找到则停止搜索，变量就绪，否则将追溯到全局变量的变量对象。若全局环境中也没有这个标识符，则意味着变量未声明。

### 4.3 垃圾收集

JavaScript具有自动垃圾回收机制：找回不再继续使用的变量，然后释放其占用的内存。垃圾回收器在固定时间间隔执行这一操作。

两种方法：

* 标记清除：进入环境时声明，退出环境时离开。
* 引用计数：引用次数为0时回收。

对开发人员来说，最好的办法是通过将其值**设置为null来释放引用**——解除引用。

:sparkles:

