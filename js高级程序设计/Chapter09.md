## 第九章：客户端检测

本章内容

- [ ] 使用能力检测
- [ ] 用户代理检测的历史
- [ ] 选择检测方式

由于现实中，浏览器之间的差异以及不同浏览器的怪癖（quirk）多得不胜枚举，因此，客户端检测除了是一种不就措施之外，更是一种行之有效的开发策略。

检测客户端的手段有很多，但是不到万不得已，就不要使用客户端检测。只要能找到更通用的方法，就应该优先采用更通用的方法。

### 9.1 能力检测

最常用也最为人们广泛接受的客户端检测形式是**能力检测**（又称特性检测）。

能力检测的目标不是识别特定的浏览器，而是识别浏览器的能力。采用这种方式不必顾及特定的浏览器如何，只要确定浏览器支持特定的能力，就可以给出解决方案。能力检测的基本模式：

````js
if(object.propertyInQuestion) {
	// 使用 object.propertyInQuestion
}
````

理解能力检测有两个重要概念：

1.先检测达成目的的最常用的特性，这样可以保证代码最优化。
2.必须测试实际要用到的特性。一个特性不存在，不一定意味着另一个特性也存在。

#### 更可靠的能力检测

在可能的情况下，要尽量使用typeof进行能力检测，特别是宿主对象没有义务让typeof返回合理的值。

#### 能力检测不是浏览器检测

检测某个或某几个特性并不能够确定浏览器。更好的方式是：知道自己的应用程序需要使用某些特定的浏览器特性，那么最好是一次性检测所有相关特性，而不是分别检测。

````js
// 确定浏览器是否支持Netscape风格的插件
var hasNSPlugins = !!(navigator.plugins && navigator.plugins.length);

// 确定浏览器是否具有DOM1级规定的能力
var hasDOM1 = !!(document.getElementById && document.createElement && document.getElementsByTagName);

// 得到的布尔值可以在以后后续使用，从而节省重新检测能力的时间。
````

### 9.2 怪癖检测

怪癖检测（quirks detection）的目标是识别浏览器的特殊行为，其目的是想知道浏览器存在什么缺陷。

建议是仅仅检测那些对你有直接影响的"怪癖"，而且最好在脚本一开始就执行此类检测，以便尽早解决问题。

### 9.3 用户代理检测

通过检测用户代理字符串来确定实际使用的浏览器。（有争议）
















































